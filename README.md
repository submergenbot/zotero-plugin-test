# PDF 问答助手 (Zotero 插件)

该插件示例展示了如何在 Zotero 7 中：

- 将当前条目关联的 PDF 提取为纯文本
- 从首选项窗口配置远程 API 地址、模型和密钥
- 在右侧信息面板中输入问题并向模型发送全文+问题
- 在独立窗口查看最近一次问答结果
- 显示提问进度、错误日志并允许取消请求

## 功能概览

1. 在首选项面板填写 API 地址、模型名称和可选的 API Key。
2. 在条目的右侧面板输入问题，点击“发送”开始：
   - 插件会提示“正在提取文本…正在发送请求…”，并在日志中输出详细进度。
   - 支持点击“取消”中止当前请求。
3. 请求结果会展示在面板中，同时保存到条目的历史记录。
4. 点击“弹出窗口”可在独立窗口中查看最近一次问答记录。

## API 请求格式

插件会向配置的远程接口发送 `POST` 请求：

```json
{
  "model": "模型名称",
  "question": "用户输入的问题",
  "document": "提取到的全文字符串"
}
```

如果配置了 API Key，会通过 `Authorization: Bearer <API_KEY>` 头部发送。

服务器返回 JSON 时，优先读取 `answer` 字段；否则会尝试解析 `data` 字段或返回的原始文本。

## 开发与构建

1. 将本仓库打包为 zip (`zip -r pdf-qa-helper.xpi *`) 后，在 Zotero 7 的“工具 → 附加组件 → 齿轮 → 安装附加组件”中选择安装。
2. 修改代码后重新打包即可更新插件。

> 注意：该示例依赖 Zotero 自带的 PDF 文本提取功能 (`Zotero.Fulltext` 或 `Zotero.PDFWorker`)。首次提取时可能需要等待索引完成。
